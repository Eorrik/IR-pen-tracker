# 软件需求规格说明书 (Software Requirements Specification)

## 1. 引言

### 1.1 目的
本文档旨在明确“基于 Kinect 的数字化书法追踪系统”的软件功能需求与非功能需求，作为开发、测试与验收的依据。

### 1.2 范围
本系统利用 Kinect 深度相机与 IMU 传感器，实时捕捉用户的上肢动作与毛笔的 6自由度 (6-DoF) 姿态，并提供可视化预览、数据记录与导出功能。

## 2. 总体描述

### 2.1 产品视角
本软件运行于 Windows PC 平台，通过 USB 连接 Azure Kinect DK 相机，通过蓝牙/串口连接 WitMotion IMU，为书法数字化研究与教学提供数据采集工具。

### 2.2 用户特征
- **终端用户**: 书法研究者、数字化艺术开发者。
- **技能要求**: 具备基本的 Windows 操作能力，了解 CSV 数据格式。

## 3. 功能需求
### 3.0 原始数据录制与离线读取
- **REQ-00**: 系统应支持录制 Kinect 原始数据并以统一结构保存，供离线读取。
  - **录制内容**: 彩色图 (NV12 转 PNG)、深度图 (16-bit PNG)、可选 IR。
  - **目录结构**: `root/color/*.png`, `root/depth/*.png`, `root/ir/*.png`, `root/meta.json`。
  - **元数据**: `meta.json` 包含 `intrinsics {fx, fy, cx, cy}`, `fps`, `timestamps`。
  - **读取接口**: 应用可通过 `FileCamera` 读取该数据结构并输出统一 `Frame`。

### 3.1 人体姿态追踪 (Human Pose Tracking)
- **REQ-01**: 系统应能实时识别并追踪用户的上肢骨架关键点。
  - **关键点范围**: 至少包含肩 (Shoulder)、肘 (Elbow)、腕 (Wrist)、手 (Hand) 的左右侧（主要关注执笔手）。
  - **输出数据**: 关键点的 3D 空间坐标 (x, y, z) 及置信度 (confidence)。
  - **可视化**: 在 RGB 预览画面上叠加显示骨架连线。

### 3.2 毛笔姿态追踪 (Brush Pose Tracking)
- **REQ-02**: 系统应能实时解算毛笔的 6-DoF 姿态。
  - **位置 (Position)**: 笔杆特定点（如笔锋或笔杆中心）在相机坐标系下的 (x, y, z) 坐标。
  - **姿态 (Orientation)**: 笔杆的空间指向，以四元数 (Quaternion) 或 欧拉角 (Pitch, Yaw, Roll) 表示。
  - **精度要求**: 能够反映书写过程中的提按（Z轴变化）、运笔方向与笔杆倾斜。
  - **鲁棒性**: 需具备一定的环境光适应能力，支持常见的室内光照条件。

### 3.3 实时预览与交互 (Preview & UI)
- **REQ-03**: 提供图形化用户界面 (GUI)。
  - **RGB 视图**: 显示彩色摄像机画面，并叠加追踪结果（骨架、笔杆轴线、质心）。
  - **Depth 视图**: 显示深度图，辅助观察追踪质量。
  - **状态面板**: 实时显示传感器连接状态、当前采样率 (FPS)、追踪锁定状态 (Locked/Lost)。
  - **控制功能**: 提供开始/停止录制、导出数据、重置视角的按钮。

### 3.4 数据录制与导出 (Recording & Export)
- **REQ-04**: 支持书写过程的数据录制。
  - **视频录制**: 将带有叠加层的预览画面录制为视频文件 (MP4/AVI)。
  - **数据导出**: 录制结束后，可将采集的原始数据导出为 CSV 文件。
    - **CSV 字段**: 包含时间戳 (Timestamp)、帧号 (Frame ID)、笔姿态数据 (Pos, Quat)、骨架关键点数据 (Joints 3D)。
  - **原始数据集**: 提供独立的原始数据集录制脚本与读取组件，以便算法离线调试与回放。

### 3.5 校准与配置 (Calibration & Configuration)
- **REQ-05**: 提供必要的系统校准功能。
  - **相机参数**: 加载或标定相机内参 (Intrinsics)。
  - **手眼标定**: 计算 IMU 坐标系与笔杆/相机坐标系的对齐矩阵。
  - **阈值调节**: 提供界面滑块 (Trackbar) 调整视觉追踪的颜色阈值 (HSV) 或亮度阈值。
  - **配置持久化**: 所有配置参数应能保存至文件，软件重启后自动加载。

## 4. 非功能需求

### 4.1 性能要求
- **实时性**: 追踪与预览的端到端延迟应控制在 60ms 以内，保证视觉反馈的流畅性。
- **帧率**: 视觉追踪处理帧率 ≥ 30 FPS；IMU 数据融合频率 ≥ 60 Hz。

### 4.2 环境约束
- **操作系统**: Windows 10/11。
- **开发环境**: Python 3.8+。
- **硬件依赖**: Azure Kinect DK; WitMotion 9-axis IMU。

### 4.3 可靠性
- **异常处理**: 传感器断连时系统不应崩溃，而应进入错误状态并提示用户。
- **数据完整性**: 导出的 CSV 数据应与视频帧严格对应（通过时间戳或帧号对齐）。
